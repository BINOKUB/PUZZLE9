<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logibase-Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; }
        .game-container { max-width: 800px; }
        .number-display { font-size: 2.5rem; font-weight: bold; border: 2px solid #ccc; border-radius: 8px; padding: 1rem; background-color: #fff; cursor: pointer; transition: all 0.2s; min-width: 100px; }
        .number-display.selected { border-color: #0d6efd; transform: scale(1.1); box-shadow: 0 0 15px rgba(13, 110, 253, 0.5); }
        .base-counter { font-size: 1.5rem; font-weight: bold; border: 2px solid #343a40; border-radius: 8px; padding: 1rem; background-color: #343a40; color: white; cursor: pointer; transition: all 0.2s; }
        .base-counter.correct { background-color: #198754; border-color: #198754; }
    </style>
</head>
<body>

    <div id="app-container" class="container text-center my-4">
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- VARIABLES POUR AJUSTER LE JEU ---
            const TIME_EASY = 30; // en secondes
            const TIME_INTERMEDIATE = 45; // en secondes
            const TIME_HARD = 60; // en secondes
            
            // Nombres de chiffres par difficulté
            const DIGITS_EASY = { min: 3, max: 3 };
            const DIGITS_INTERMEDIATE = { min: 3, max: 6 };
            const DIGITS_HARD = { min: 6, max: 6 };
            // -----------------------------------------

            const appContainer = document.getElementById('app-container');
            let timerInterval = null;
            let currentNumbers = [];
            let solvedBases = new Set();
            let selectedNumber = null;
            let selectedNumberElement = null;

            function showConfigScreen() {
                clearInterval(timerInterval);
                appContainer.innerHTML = `
                    <h1 class="mb-4">Logibase-Quiz</h1>
                    <p class="lead">Choisissez votre défi. Associez chaque numéro à sa base avant la fin du temps. Une seule erreur et la partie est terminée !</p>
                    <div class="d-grid gap-3 col-md-6 mx-auto mt-5">
                        <button class="btn btn-success btn-lg" data-difficulty="EASY">Facile (3 suites)</button>
                        <button class="btn btn-warning btn-lg" data-difficulty="INTERMEDIATE">Intermédiaire (5 suites)</button>
                        <button class="btn btn-danger btn-lg" data-difficulty="HARD">Difficile (10 suites)</button>
                    </div>`;
                
                appContainer.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        startGame(button.dataset.difficulty);
                    });
                });
            }

            function startGame(difficulty) {
                const difficultyConfig = {
                    EASY: { count: 3, time: TIME_EASY, digits: DIGITS_EASY },
                    INTERMEDIATE: { count: 5, time: TIME_INTERMEDIATE, digits: DIGITS_INTERMEDIATE },
                    HARD: { count: 10, time: TIME_HARD, digits: DIGITS_HARD }
                };
                const config = difficultyConfig[difficulty];

                currentNumbers = [];
                solvedBases = new Set();
                selectedNumber = null;
                selectedNumberElement = null;
                
                for (let i = 0; i < config.count; i++) {
                    currentNumbers.push(generateValidNumber(config.digits.min, config.digits.max));
                }

                showGameScreen(config);
            }

            function showGameScreen(config) {
                appContainer.innerHTML = `
                    <div class="mb-3">
                        <div id="timer-display" class="fs-1 fw-bold"></div>
                    </div>
                    <div id="numbers-container" class="d-flex justify-content-center flex-wrap gap-3 my-4"></div>
                    <div id="bases-container" class="d-flex justify-content-center flex-wrap gap-3"></div>
                    <div class="d-grid gap-2 col-6 mx-auto mt-5">
                         <button id="menu-btn" class="btn btn-secondary">Menu</button>
                    </div>
                    `;
                
                document.getElementById('menu-btn').addEventListener('click', showConfigScreen);
                renderNumbers();
                renderBases();
                
                let timeLeft = config.time;
                const timerDisplay = document.getElementById('timer-display');
                timerDisplay.textContent = timeLeft;

                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft < 0) {
                        clearInterval(timerInterval);
                        alert("Temps écoulé ! Game Over.");
                        showConfigScreen();
                    }
                }, 1000);
            }

            function getBase(number) { let sNumber = number.toString(); while (sNumber.length > 1) { let sum = 0; for (const char of sNumber) { sum += parseInt(char, 10); } sNumber = sum.toString(); } return parseInt(sNumber, 10); }
            
            function generateValidNumber(minDigits, maxDigits) {
                let number;
                do {
                    const numDigits = Math.floor(Math.random() * (maxDigits - minDigits + 1)) + minDigits;
                    const minRange = Math.pow(10, numDigits - 1);
                    const maxRange = Math.pow(10, numDigits) - 1;
                    number = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
                } while (number.toString().includes('0'));
                return number;
            }
            
            function renderNumbers() {
                const container = document.getElementById('numbers-container');
                container.innerHTML = '';
                currentNumbers.forEach((num, index) => {
                    const el = document.createElement('div');
                    el.className = 'number-display';
                    el.textContent = num;
                    el.dataset.index = index;
                    el.addEventListener('click', () => onNumberClick(el, num));
                    container.appendChild(el);
                });
            }
            
            function renderBases() {
                const container = document.getElementById('bases-container');
                container.innerHTML = '';
                for(let i = 1; i <= 9; i++) {
                    const el = document.createElement('div');
                    el.className = 'base-counter';
                    el.textContent = i;
                    el.dataset.base = i;
                    if (solvedBases.has(i)) {
                        el.classList.add('correct');
                    }
                    el.addEventListener('click', () => onBaseClick(el, i));
                    container.appendChild(el);
                }
            }

            function onNumberClick(element, number) {
                if (selectedNumberElement) {
                    selectedNumberElement.classList.remove('selected');
                }
                selectedNumber = number;
                selectedNumberElement = element;
                selectedNumberElement.classList.add('selected');
            }

            function onBaseClick(baseElement, base) {
                if (!selectedNumber || selectedNumberElement.style.visibility === 'hidden') return;

                const correctBase = getBase(selectedNumber);

                if (base === correctBase) {
                    solvedBases.add(base);
                    selectedNumberElement.style.visibility = 'hidden';
                    baseElement.classList.add('correct');
                    
                    selectedNumber = null;
                    selectedNumberElement = null;

                    if (solvedBases.size === currentNumbers.length) {
                        clearInterval(timerInterval);
                        alert("Partie Parfaite !");
                        showConfigScreen();
                    }
                } else {
                    clearInterval(timerInterval);
                    alert(`Game Over ! La base de ${selectedNumber} était ${correctBase}.`);
                    showConfigScreen();
                }
            }
            
            showConfigScreen();
        });
    </script>

</body>
</html>