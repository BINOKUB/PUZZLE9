<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS HARMONIQUE - Perfect Center</title>
    <style>
        :root {
            --bg-color: #050508;
            --ring-color: rgba(255, 255, 255, 0.15);
            --text-primary: #fff;
            --highlight-main: #00f3ff; /* Cyan */
            --highlight-rel: #ff00ff;  /* Magenta */
            --glow-strength: 15px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow: hidden;
            touch-action: none; /* Bloque tout scroll/zoom parasite */
        }

        h1 {
            font-weight: 300; letter-spacing: 4px; text-transform: uppercase;
            margin-bottom: 0; margin-top: 20px; 
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
            font-size: 20px; text-align: center;
            position: absolute; top: 20px; width: 100%; z-index: 100;
        }

        /* CONTENEUR PRINCIPAL FLUIDE */
        #nexus-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* LA CIBLE DE SCALE (600x600 de base) */
        #harmonic-nexus {
            position: relative; 
            width: 600px; height: 600px; 
            /* On ne met pas de scale ici, on le gère en JS */
            transform-origin: center center;
            flex-shrink: 0; /* Empêche l'écrasement */
        }
        
        /* CORRECTION DU CENTRAGE DES ANNEAUX */
        .ring { 
            position: absolute; 
            border-radius: 50%; 
            border: 1px solid var(--ring-color); 
            pointer-events: none;
            /* MAGIE DU CENTRAGE : */
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        .ring-outer { width: 550px; height: 550px; }
        .ring-inner { width: 350px; height: 350px; border-style: dashed; opacity: 0.5; }

        .note-node {
            position: absolute; display: flex; align-items: center; justify-content: center;
            width: 60px; height: 60px; border-radius: 50%; background: var(--bg-color);
            border: 2px solid #333; font-weight: bold; cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 10;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        .major-node { font-size: 1.2rem; }
        .minor-node { font-size: 0.9rem; color: #aaa; border-color: #222; }

        /* ETATS ACTIFS */
        .active-primary {
            border-color: var(--highlight-main) !important;
            color: var(--highlight-main) !important;
            box-shadow: 0 0 var(--glow-strength) var(--highlight-main), inset 0 0 10px var(--highlight-main);
            transform: scale(1.2); z-index: 20;
        }
        
        .active-primary-min {
            border-color: var(--highlight-rel) !important;
            color: var(--highlight-rel) !important;
            box-shadow: 0 0 var(--glow-strength) var(--highlight-rel), inset 0 0 10px var(--highlight-rel);
            transform: scale(1.2); z-index: 20;
        }

        .active-secondary {
            border-color: #fff !important;
            color: #fff !important;
            box-shadow: 0 0 var(--glow-strength) rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        /* CENTRE */
        #center-hub {
            position: absolute; 
            /* Centrage Absolu du Hub */
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 120px; height: 120px; background: #000;
            border-radius: 50%; border: 2px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.8); z-index: 5;
        }
        #hub-key { font-size: 2rem; font-weight: 700; margin: 0; color: #fff; }
        #hub-desc { font-size: 0.8rem; color: #666; margin-top: 5px; }

    </style>
</head>
<body>

    <h1>NEXUS HARMONIQUE</h1>

    <div id="nexus-container">
        <div id="harmonic-nexus">
            <div class="ring ring-outer"></div>
            <div class="ring ring-inner"></div>
            
            <div id="center-hub">
                <h2 id="hub-key">--</h2>
                <span id="hub-desc">Touchez une clé</span>
            </div>
        </div>
    </div>

    <script>
        const container = document.getElementById('nexus-container');
        const nexus = document.getElementById('harmonic-nexus');
        const hubKey = document.getElementById('hub-key');
        const hubDesc = document.getElementById('hub-desc');

        const cycleData = [
            { maj: "C",  min: "Am"  }, { maj: "G",  min: "Em"  }, { maj: "D",  min: "Bm"  },
            { maj: "A",  min: "F#m" }, { maj: "E",  min: "C#m" }, { maj: "B",  min: "G#m" },
            { maj: "F#", min: "D#m" }, { maj: "Db", min: "Bbm" }, { maj: "Ab", min: "Fm"  },
            { maj: "Eb", min: "Cm"  }, { maj: "Bb", min: "Gm"  }, { maj: "F",  min: "Dm"  }
        ];

        const radiusOuter = 275;
        const radiusInner = 175;

        // --- 1. INITIALISATION DES NOEUDS ---
        cycleData.forEach((data, i) => {
            const angleRad = ((i * 30) - 90) * (Math.PI / 180);
            createNode(data.maj, i, 'major-node', radiusOuter, angleRad, 'maj');
            createNode(data.min, i, 'minor-node', radiusInner, angleRad, 'min');
        });

        function createNode(text, index, typeClass, radius, rad, type) {
            const node = document.createElement('div');
            node.classList.add('note-node', typeClass);
            node.innerText = text;
            node.dataset.index = index;
            node.dataset.type = type;

            // Calcul centré sur 300, 300
            const x = 300 + radius * Math.cos(rad) - 30; 
            const y = 300 + radius * Math.sin(rad) - 30;
            node.style.left = `${x}px`;
            node.style.top = `${y}px`;

            // EVENTS
            node.addEventListener('mouseenter', () => engageHarmony(index, type));
            node.addEventListener('touchstart', (e) => {
                e.preventDefault(); 
                engageHarmony(index, type);
            }, {passive: false});
            
            nexus.appendChild(node);
        }

        // --- 2. LOGIQUE DE REDIMENSIONNEMENT INTELLIGENT ---
        function resizeNexus() {
            // On veut que le cercle (600px) rentre dans l'écran avec une marge
            const margin = 40; 
            const availableWidth = window.innerWidth - margin;
            const availableHeight = window.innerHeight - 100; // Place pour le titre

            // On cherche le facteur d'échelle le plus petit
            const scaleW = availableWidth / 600;
            const scaleH = availableHeight / 600;
            let scale = Math.min(scaleW, scaleH);

            // On ne grossit pas plus que 1 (sur desktop)
            if (scale > 1) scale = 1;

            // Application du scale
            nexus.style.transform = `scale(${scale})`;
        }

        // Appel au chargement et au redimensionnement
        window.addEventListener('resize', resizeNexus);
        window.addEventListener('load', resizeNexus);
        resizeNexus(); // Appel immédiat

        // --- 3. LOGIQUE HARMONIQUE ---
        document.body.addEventListener('touchstart', (e) => {
            if(!e.target.classList.contains('note-node')) resetHarmony();
        });
        nexus.addEventListener('mouseleave', resetHarmony);

        function engageHarmony(selectedIndex, type) {
            resetHarmony();
            
            const nodes = document.querySelectorAll('.note-node');
            const selectedData = cycleData[selectedIndex];

            if (type === 'maj') {
                hubKey.innerText = selectedData.maj;
                hubDesc.innerText = `Relatif: ${selectedData.min}`;
                hubKey.style.color = "var(--highlight-main)";
            } else {
                hubKey.innerText = selectedData.min;
                hubDesc.innerText = `Relatif: ${selectedData.maj}`;
                hubKey.style.color = "var(--highlight-rel)";
            }

            const prevIndex = (selectedIndex - 1 + 12) % 12;
            const nextIndex = (selectedIndex + 1) % 12;

            nodes.forEach(node => {
                const idx = parseInt(node.dataset.index);
                const nodeType = node.dataset.type;
                
                if (idx === selectedIndex && nodeType === type) {
                    node.classList.add(type === 'min' ? 'active-primary-min' : 'active-primary');
                }
                else if (idx === selectedIndex && nodeType !== type) {
                    node.classList.add('active-secondary');
                }
                else if (idx === prevIndex || idx === nextIndex) {
                    node.classList.add('active-secondary');
                }
            });
        }

        function resetHarmony() {
            document.querySelectorAll('.note-node').forEach(n => {
                n.classList.remove('active-primary', 'active-primary-min', 'active-secondary');
            });
            hubKey.innerText = "--";
            hubDesc.innerText = "Touchez une clé";
            hubKey.style.color = "#fff";
        }
    </script>
</body>
</html>
