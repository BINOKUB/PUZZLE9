<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS HARMONIQUE - Responsive</title>
    <style>
        :root {
            --bg-color: #050508;
            --ring-color: rgba(255, 255, 255, 0.1);
            --text-primary: #fff;
            --highlight-main: #00f3ff; /* Cyan Neon */
            --highlight-rel: #ff00ff;  /* Magenta Neon */
            --glow-strength: 15px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow: hidden;
            touch-action: manipulation; /* Améliore le tactile */
        }

        h1 {
            font-weight: 300; letter-spacing: 4px; text-transform: uppercase;
            margin-bottom: 20px; text-shadow: 0 0 10px rgba(255,255,255,0.3);
            font-size: 24px; text-align: center;
        }

        /* CONTENEUR RESPONSIVE */
        #nexus-container {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #harmonic-nexus {
            position: relative; 
            width: 600px; height: 600px; /* Taille de base fixe pour les calculs */
            display: flex; align-items: center; justify-content: center;
            /* MAGIE RESPONSIVE : Si l'écran est petit, on dézoome */
            transform-origin: center center;
        }
        
        /* Media Query pour Mobile : on réduit l'échelle si l'écran < 620px */
        @media (max-width: 620px) {
            #harmonic-nexus {
                transform: scale(0.55); /* Réduit à 55% de la taille */
            }
            h1 { font-size: 18px; margin-top: 20px; }
        }

        .ring { position: absolute; border-radius: 50%; border: 1px solid var(--ring-color); pointer-events: none; }
        .ring-outer { width: 550px; height: 550px; }
        .ring-inner { width: 350px; height: 350px; border-style: dashed; opacity: 0.5; }

        .note-node {
            position: absolute; display: flex; align-items: center; justify-content: center;
            width: 60px; height: 60px; border-radius: 50%; background: var(--bg-color);
            border: 2px solid #333; font-weight: bold; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 10;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        .major-node { font-size: 1.2rem; }
        .minor-node { font-size: 0.9rem; color: #aaa; border-color: #222; }

        /* Interaction */
        .active-primary {
            border-color: var(--highlight-main) !important;
            color: var(--highlight-main) !important;
            box-shadow: 0 0 var(--glow-strength) var(--highlight-main), inset 0 0 10px var(--highlight-main);
            transform: scale(1.2); z-index: 20;
        }
        
        .active-primary-min {
            border-color: var(--highlight-rel) !important;
            color: var(--highlight-rel) !important;
            box-shadow: 0 0 var(--glow-strength) var(--highlight-rel), inset 0 0 10px var(--highlight-rel);
            transform: scale(1.2); z-index: 20;
        }

        .active-secondary {
            border-color: #fff !important;
            color: #fff !important;
            box-shadow: 0 0 var(--glow-strength) rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        #center-hub {
            position: absolute; width: 120px; height: 120px; background: #000;
            border-radius: 50%; border: 2px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.8); z-index: 5;
        }
        #hub-key { font-size: 2rem; font-weight: 700; margin: 0; color: #fff; }
        #hub-desc { font-size: 0.8rem; color: #666; margin-top: 5px; }

    </style>
</head>
<body>

    <h1>NEXUS HARMONIQUE</h1>

    <div id="nexus-container">
        <div id="harmonic-nexus">
            <div class="ring ring-outer"></div>
            <div class="ring ring-inner"></div>
            
            <div id="center-hub">
                <h2 id="hub-key">--</h2>
                <span id="hub-desc">Touchez une clé</span>
            </div>
        </div>
    </div>

    <script>
        const nexus = document.getElementById('harmonic-nexus');
        const hubKey = document.getElementById('hub-key');
        const hubDesc = document.getElementById('hub-desc');

        const cycleData = [
            { maj: "C",  min: "Am"  }, { maj: "G",  min: "Em"  }, { maj: "D",  min: "Bm"  },
            { maj: "A",  min: "F#m" }, { maj: "E",  min: "C#m" }, { maj: "B",  min: "G#m" },
            { maj: "F#", min: "D#m" }, { maj: "Db", min: "Bbm" }, { maj: "Ab", min: "Fm"  },
            { maj: "Eb", min: "Cm"  }, { maj: "Bb", min: "Gm"  }, { maj: "F",  min: "Dm"  }
        ];

        const radiusOuter = 275;
        const radiusInner = 175;

        cycleData.forEach((data, i) => {
            const angleRad = ((i * 30) - 90) * (Math.PI / 180);
            createNode(data.maj, i, 'major-node', radiusOuter, angleRad, 'maj');
            createNode(data.min, i, 'minor-node', radiusInner, angleRad, 'min');
        });

        function createNode(text, index, typeClass, radius, rad, type) {
            const node = document.createElement('div');
            node.classList.add('note-node', typeClass);
            node.innerText = text;
            node.dataset.index = index;
            node.dataset.type = type;

            const x = 300 + radius * Math.cos(rad) - 30; 
            const y = 300 + radius * Math.sin(rad) - 30;
            node.style.left = `${x}px`;
            node.style.top = `${y}px`;

            // Ajout du support TACTILE (Touchstart) pour le mobile
            node.addEventListener('mouseenter', () => engageHarmony(index, type));
            node.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Empêche le zoom double-tap
                engageHarmony(index, type);
            });
            
            nexus.appendChild(node);
        }

        // Ajout d'un écouteur global pour "éteindre" quand on touche ailleurs sur mobile
        document.body.addEventListener('touchstart', (e) => {
            if(!e.target.classList.contains('note-node')) resetHarmony();
        });
        nexus.addEventListener('mouseleave', resetHarmony);

        function engageHarmony(selectedIndex, type) {
            resetHarmony();
            
            const nodes = document.querySelectorAll('.note-node');
            const selectedData = cycleData[selectedIndex];

            if (type === 'maj') {
                hubKey.innerText = selectedData.maj;
                hubDesc.innerText = `Relatif: ${selectedData.min}`;
                hubKey.style.color = "var(--highlight-main)";
            } else {
                hubKey.innerText = selectedData.min;
                hubDesc.innerText = `Relatif: ${selectedData.maj}`;
                hubKey.style.color = "var(--highlight-rel)";
            }

            const prevIndex = (selectedIndex - 1 + 12) % 12;
            const nextIndex = (selectedIndex + 1) % 12;

            nodes.forEach(node => {
                const idx = parseInt(node.dataset.index);
                const nodeType = node.dataset.type;
                
                if (idx === selectedIndex && nodeType === type) {
                    node.classList.add(type === 'min' ? 'active-primary-min' : 'active-primary');
                }
                else if (idx === selectedIndex && nodeType !== type) {
                    node.classList.add('active-secondary');
                }
                else if (idx === prevIndex || idx === nextIndex) {
                    node.classList.add('active-secondary');
                }
            });
        }

        function resetHarmony() {
            document.querySelectorAll('.note-node').forEach(n => {
                n.classList.remove('active-primary', 'active-primary-min', 'active-secondary');
            });
            hubKey.innerText = "--";
            hubDesc.innerText = "Touchez une clé";
            hubKey.style.color = "#fff";
        }
    </script>
</body>
</html>
