<style>
    /* Ajout du style pour les règles */
    .rules-box {
        max-width: 500px; background: rgba(255,255,255,0.05);
        border-radius: 15px; padding: 15px; margin-top: 20px;
        font-size: 0.8rem; border-left: 4px solid var(--cyan);
    }
    .rules-box h4 { margin-top: 0; color: var(--cyan); text-transform: uppercase; }
</style>

<div class="rules-box">
    <h4>Comment Jouer ?</h4>
    <p>Faites 21 ou battez le score de Jak sans dépasser 21. Les Figures valent 10, l'As vaut 1 ou 11.</p>
</div>

<script>
    let deck = [], playerHand = [], jakHand = [], gameOver = false;

    // BANQUE DE RÉPLIQUES DE JAK
    const jakTalk = {
        start: ["Bienvenue. Prêt pour un duel d'esprit ?", "Chaque carte est un symbole d'espoir. On commence ?"],
        win: ["21 ! Magnifique. Si seulement chaque combat se terminait ainsi.", "Vous avez battu la maison ! Votre intuition est remarquable."],
        lose: ["Jak l'emporte... cette fois. Mais le combat continue ensemble.", "La chance a tourné. Mais chaque tentative nous rapproche de la solution."],
        draw: ["Un match nul. Comme deux forces qui se mesurent avant la percée."],
        hit: ["Un choix audacieux. Voyons ce que le destin nous réserve.", "Prudence ou audace ? Le jeu est lancé."]
    };

    function speak(type) {
        const phrases = jakTalk[type];
        document.getElementById('jak-msg').innerText = phrases[Math.floor(Math.random() * phrases.length)];
    }

    function createDeck() {
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const symbols = ['♠️', '♥️', '♦️', '♣️'];
        deck = [];
        for (let s of symbols) {
            for (let v of values) {
                let val = parseInt(v);
                if (['J', 'Q', 'K'].includes(v)) val = 10;
                if (v === 'A') val = 11;
                deck.push({ n: v, s: s, v: val });
            }
        }
    }

    function getScore(hand) {
        let score = hand.reduce((acc, card) => acc + card.v, 0);
        let aces = hand.filter(c => c.n === 'A').length;
        while (score > 21 && aces > 0) { score -= 10; aces--; }
        return score;
    }

    function renderHand(hand, elementId, hideFirst = false) {
        const el = document.getElementById(elementId);
        el.innerHTML = hand.map((c, i) => 
            `<div class="card" style="color:${(c.s==='♥️'||c.s==='♦️')?'red':'black'}">
                ${(hideFirst && i === 0) ? '?' : c.n + '<br>' + c.s}
             </div>`
        ).join('');
    }

    function initGame() {
        gameOver = false;
        createDeck();
        deck.sort(() => Math.random() - 0.5);
        playerHand = [deck.pop(), deck.pop()];
        jakHand = [deck.pop(), deck.pop()];
        speak('start');
        updateUI();
        document.getElementById('controls').style.display = 'flex';
        document.getElementById('final-controls').style.display = 'none';
    }

    function updateUI() {
        renderHand(playerHand, 'player-cards');
        renderHand(jakHand, 'jak-cards', true);
        document.getElementById('score-display').innerText = "VOTRE SCORE : " + getScore(playerHand);
    }

    function hit() {
        if (gameOver) return;
        playerHand.push(deck.pop());
        speak('hit');
        updateUI();
        if (getScore(playerHand) > 21) endGame("Jak l'emporte !");
    }

    function stay() {
        gameOver = true;
        // Tour de Jak (il s'arrête à 17)
        while (getScore(jakHand) < 17) { jakHand.push(deck.pop()); }
        endGame();
    }

    function endGame(msg = "") {
        gameOver = true;
        renderHand(jakHand, 'jak-cards', false);
        const pScore = getScore(playerHand);
        const jScore = getScore(jakHand);

        if (pScore > 21) { speak('lose'); }
        else if (jScore > 21 || pScore > jScore) { speak('win'); }
        else if (pScore === jScore) { speak('draw'); }
        else { speak('lose'); }

        document.getElementById('controls').style.display = 'none';
        document.getElementById('final-controls').style.display = 'block';
    }

    window.onload = initGame;
</script>
