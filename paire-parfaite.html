<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paire Parfaite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* MODIFIÉ : Méthode de centrage plus robuste */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            font-family: sans-serif;
            background-color: #f0f2f5;
        }

        #app-container {
            width: 100%;
            max-width: 800px; /* Largeur maximale du contenu */
            text-align: center;
        }

        #game-grid {
            display: inline-grid;
            grid-template-columns: repeat(9, 45px);
            gap: 3px;
            background-color: #343a40;
            padding: 3px;
            border-radius: 8px;
            margin: 2rem auto;
        }

        .grid-cell {
            width: 45px;
            height: 45px;
            background-color: #fff;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease-in-out;
        }

        .grid-cell.selected {
            border-color: #0d6efd;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(13, 110, 253, 0.5);
        }

        .grid-cell.orphan {
            background-color: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
        }
        
        .paired-1 { background-color: rgba(220, 53, 69, 0.4); }
        .paired-2 { background-color: rgba(13, 110, 253, 0.4); }
        .paired-3 { background-color: rgba(25, 135, 84, 0.4); }
        .paired-4 { background-color: rgba(111, 66, 193, 0.4); }
        .paired-5 { background-color: rgba(255, 193, 7, 0.4); }
        .paired-6 { background-color: rgba(13, 202, 240, 0.4); }
        .paired-7 { background-color: rgba(255, 255, 224, 1); } /* Jaune */
        .paired-8 { background-color: rgba(109, 76, 65, 0.4); }
        .paired-9 { background-color: rgba(69, 90, 100, 0.4); }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div id="app-container">
        </div>

    <script>
        // REV 2.1
        document.addEventListener('DOMContentLoaded', () => {

            const appContainer = document.getElementById('app-container');
            
            // --- VARIABLES DE CONFIGURATION DU JEU ---
            const DIFFICULTY_CONFIG = {
                PRATIQUE:    { minDigits: 2, maxDigits: 4, points: 0 },
                FACILE:      { minDigits: 2, maxDigits: 2, points: 50 },
                INTERMEDIAIRE: { minDigits: 3, maxDigits: 3, points: 150 },
                DIFFICILE:   { minDigits: 4, maxDigits: 4, points: 1000 }
            };
            
            let settings = {};
            let timerInterval = null;
            let timeElapsed = 0;
            let score = 0;
            let mistakesMade = 0;
            let gameBoard = [];
            let firstSelection = null;

            function showConfigScreen() {
                clearInterval(timerInterval);
                appContainer.innerHTML = `
                    <h1 class="mb-4">Paire Parfaite</h1>
                    <p class="lead">Trouvez les paires de numéros qui ont la même base.</p>
                    <div class="col-md-6 mx-auto mt-5">
                        <select id="difficulty-select" class="form-select form-select-lg">
                            <option value="PRATIQUE">Mode Pratique</option>
                            <option value="FACILE">Facile</option>
                            <option value="INTERMEDIAIRE" selected>Intermédiaire</option>
                            <option value="DIFFICILE">Difficile</option>
                        </select>
                        <button id="start-btn" class="btn btn-primary btn-lg mt-3 w-100">Jouer</button>
                    </div>`;
                
                document.getElementById('start-btn').addEventListener('click', () => {
                    const selectedDifficulty = document.getElementById('difficulty-select').value;
                    startGame(selectedDifficulty);
                });
            }

            function startGame(difficulty) {
                settings = { difficulty, ...DIFFICULTY_CONFIG[difficulty] };
                showGameScreen();

                score = 0;
                mistakesMade = 0;
                timeElapsed = 0;
                firstSelection = null;
                let numbers = new Set();
                
                while (numbers.size < 81) {
                    numbers.add(generateValidNumber(settings.minDigits, settings.maxDigits));
                }
                
                let numbersArray = Array.from(numbers).map(num => ({ number: num, base: getBase(num) }));
                let baseCounts = {};
                numbersArray.forEach(n => { baseCounts[n.base] = (baseCounts[n.base] || 0) + 1; });

                let orphans = new Set();
                for (let base = 1; base <= 9; base++) {
                    if (baseCounts[base] % 2 !== 0) {
                        const candidates = numbersArray.filter(n => n.base === base && !orphans.has(n));
                        const orphanIndex = Math.floor(Math.random() * candidates.length);
                        orphans.add(candidates[orphanIndex].number);
                    }
                }
                
                gameBoard = numbersArray.map(n => ({ ...n, isOrphan: orphans.has(n.number), isPaired: false }));
                
                renderBoard();
                updateDisplay();

                timerInterval = setInterval(() => {
                    timeElapsed++;
                    updateDisplay();
                }, 1000);
            }

            function showGameScreen() {
                appContainer.innerHTML = `
                    <div class="game-container">
                        <div id="game-info" class="row my-3 fs-5">
                            <div id="score-display" class="col text-start">Score : 0</div>
                            <div id="pairs-display" class="col text-center">Paires restantes : 0</div>
                            <div id="timer-display" class="col text-end"></div>
                        </div>
                        <div id="game-grid"></div>
                        <div id="game-controls" class="d-grid gap-2 col-6 mx-auto mt-4">
                            <button id="menu-btn" class="btn btn-secondary">Menu</button>
                            <button id="help-btn" class="btn btn-info">Comment Jouer</button>
                        </div>
                    </div>`;
                
                document.getElementById('menu-btn').addEventListener('click', showConfigScreen);
                document.getElementById('help-btn').addEventListener('click', () => {
                    alert("Trouvez et cliquez sur deux numéros qui ont la même base. Les numéros grisés sont des 'orphelins' et n'ont pas de paire.");
                });
            }

            function getBase(number) { let sNumber = number.toString(); while (sNumber.length > 1) { let sum = 0; for (const char of sNumber) { sum += parseInt(char, 10); } sNumber = sum.toString(); } return parseInt(sNumber, 10); }
            function generateValidNumber(minDigits, maxDigits) { let number; do { const numDigits = Math.floor(Math.random() * (maxDigits - minDigits + 1)) + minDigits; const min = Math.pow(10, numDigits - 1); const max = Math.pow(10, numDigits) - 1; number = Math.floor(Math.random() * (max - min + 1)) + min; } while (number.toString().includes('0')); return number; }
            
            function renderBoard() {
                const gridContainer = document.getElementById('game-grid');
                gridContainer.innerHTML = '';
                gameBoard.forEach((cellData, index) => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = cellData.number;
                    cell.dataset.index = index;
                    if (cellData.isOrphan) {
                        cell.classList.add('orphan');
                    } else if (cellData.isPaired) {
                        cell.classList.add(`paired-${cellData.base}`);
                    } else {
                        cell.addEventListener('click', () => onCellClick(cell, index));
                    }
                    gridContainer.appendChild(cell);
                });
            }

            function onCellClick(element, index) {
                if (!firstSelection) {
                    firstSelection = { element, index };
                    element.classList.add('selected');
                } else {
                    if (firstSelection.index === index) {
                        firstSelection.element.classList.remove('selected');
                        firstSelection = null;
                        return;
                    }
                    const firstNum = gameBoard[firstSelection.index];
                    const secondNum = gameBoard[index];
                    if (firstNum.base === secondNum.base) {
                        score += settings.points;
                        firstNum.isPaired = true;
                        secondNum.isPaired = true;
                        firstSelection.element.classList.add(`paired-${firstNum.base}`);
                        element.classList.add(`paired-${secondNum.base}`);
                    } else {
                        score -= settings.points;
                        mistakesMade++;
                        alert("Paire incompatible !");
                    }
                    firstSelection.element.classList.remove('selected');
                    firstSelection = null;
                    updateDisplay();
                    checkWinCondition();
                }
            }
            
            function updateDisplay() {
                document.getElementById('score-display').textContent = `Score : ${score}`;
                const minutes = Math.floor(timeElapsed / 60);
                const seconds = timeElapsed % 60;
                document.getElementById('timer-display').textContent = `Temps : ${minutes}:${seconds.toString().padStart(2, '0')}`;
                const totalPairs = Math.floor((81 - gameBoard.filter(n => n.isOrphan).length) / 2);
                const pairsFound = gameBoard.filter(n => n.isPaired).length / 2;
                document.getElementById('pairs-display').textContent = `Paires restantes : ${totalPairs - pairsFound}`;
            }

            function checkWinCondition() {
                const pairsFound = gameBoard.filter(n => n.isPaired).length / 2;
                const totalPairs = Math.floor((81 - gameBoard.filter(n => n.isOrphan).length) / 2);
                if (pairsFound === totalPairs) {
                    clearInterval(timerInterval);
                    if (settings.difficulty === 'PRATIQUE') {
                        const message = mistakesMade === 0 ? "Partie parfaite !" : "Bravo, vous évoluez !";
                        alert(message);
                    } else {
                        alert(`Partie terminée !\nScore Final : ${score}`);
                    }
                    showConfigScreen();
                }
            }
            
            showConfigScreen();
        });
    </script>
</body>
</html>